<!doctype html>
<html lang="ko" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-variant-numeric: tabular-nums;
        }
        
        .pulse-animation {
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .button-hover {
            transition: all 0.2s ease-in-out;
        }
        
        .button-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
  <main class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
   <header class="text-center mb-8">
    <h1 id="timer-title" class="text-3xl font-bold text-gray-800 mb-2">타이머</h1>
    <div class="w-16 h-1 bg-blue-500 mx-auto rounded-full"></div>
   </header>
   <section class="text-center mb-8">
    <div id="timer-display" class="timer-display text-6xl font-bold text-gray-800 mb-6">
     00:00
    </div>
    <div class="grid grid-cols-3 gap-3 mb-6">
     <div><label for="minutes" class="block text-sm font-medium text-gray-600 mb-1">분</label> <input type="number" id="minutes" min="0" max="59" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="seconds" class="block text-sm font-medium text-gray-600 mb-1">초</label> <input type="number" id="seconds" min="0" max="59" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div class="flex items-end"><button id="set-time-btn" class="w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 button-hover text-sm font-medium"> 설정 </button>
     </div>
    </div>
   </section>
   <section class="flex gap-3 justify-center"><button id="start-pause-btn" class="px-6 py-3 bg-green-500 text-white rounded-lg font-semibold button-hover flex-1"> 시작 </button> <button id="reset-btn" class="px-6 py-3 bg-red-500 text-white rounded-lg font-semibold button-hover flex-1"> 리셋 </button>
   </section>
   <div id="completion-message" class="hidden mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center">
    <div class="text-green-800 font-semibold">
     ⏰ 타이머 완료!
    </div>
    <div class="text-green-600 text-sm mt-1">
     설정한 시간이 끝났습니다.
    </div>
   </div>
  </main>
  <script>
        let timerInterval = null;
        let totalSeconds = 300; // 5분 기본값
        let remainingSeconds = totalSeconds;
        let isRunning = false;
        let isPaused = false;

        const defaultConfig = {
            timer_title: "타이머",
            start_button_text: "시작",
            pause_button_text: "일시정지",
            reset_button_text: "리셋",
            primary_color: "#10b981",
            secondary_color: "#ef4444",
            background_color: "#ffffff",
            text_color: "#1f2937",
            font_family: "system-ui"
        };

        // DOM 요소들
        const timerDisplay = document.getElementById('timer-display');
        const minutesInput = document.getElementById('minutes');
        const secondsInput = document.getElementById('seconds');
        const setTimeBtn = document.getElementById('set-time-btn');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const completionMessage = document.getElementById('completion-message');
        const timerTitle = document.getElementById('timer-title');

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            timerDisplay.textContent = formatTime(remainingSeconds);
            
            if (isRunning && !isPaused) {
                timerDisplay.classList.add('pulse-animation');
            } else {
                timerDisplay.classList.remove('pulse-animation');
            }
        }

        function setTime() {
            if (isRunning) return;
            
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            
            totalSeconds = minutes * 60 + seconds;
            remainingSeconds = totalSeconds;
            
            updateDisplay();
            completionMessage.classList.add('hidden');
        }

        function startTimer() {
            if (remainingSeconds <= 0) {
                setTime();
                if (remainingSeconds <= 0) return;
            }
            
            isRunning = true;
            isPaused = false;
            startPauseBtn.textContent = window.elementSdk?.config?.pause_button_text || defaultConfig.pause_button_text;
            
            timerInterval = setInterval(() => {
                remainingSeconds--;
                updateDisplay();
                
                if (remainingSeconds <= 0) {
                    stopTimer();
                    showCompletion();
                }
            }, 1000);
            
            updateDisplay();
        }

        function pauseTimer() {
            isRunning = false;
            isPaused = true;
            clearInterval(timerInterval);
            startPauseBtn.textContent = window.elementSdk?.config?.start_button_text || defaultConfig.start_button_text;
            updateDisplay();
        }

        function stopTimer() {
            isRunning = false;
            isPaused = false;
            clearInterval(timerInterval);
            startPauseBtn.textContent = window.elementSdk?.config?.start_button_text || defaultConfig.start_button_text;
            updateDisplay();
        }

        function resetTimer() {
            stopTimer();
            remainingSeconds = totalSeconds;
            updateDisplay();
            completionMessage.classList.add('hidden');
        }

        function showCompletion() {
            completionMessage.classList.remove('hidden');
            // 간단한 시각적 알림 (브라우저 다이얼로그 대신)
            document.body.style.animation = 'pulse 0.5s ease-in-out 3';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 1500);
        }

        // 이벤트 리스너
        setTimeBtn.addEventListener('click', setTime);
        
        startPauseBtn.addEventListener('click', () => {
            if (isRunning && !isPaused) {
                pauseTimer();
            } else {
                startTimer();
            }
        });
        
        resetBtn.addEventListener('click', resetTimer);
        
        minutesInput.addEventListener('change', () => {
            if (!isRunning) setTime();
        });
        
        secondsInput.addEventListener('change', () => {
            if (!isRunning) setTime();
        });

        // Element SDK 설정
        async function render(config) {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'system-ui, -apple-system, sans-serif';
            
            // 텍스트 업데이트
            timerTitle.textContent = config.timer_title || defaultConfig.timer_title;
            
            if (!isRunning || isPaused) {
                startPauseBtn.textContent = config.start_button_text || defaultConfig.start_button_text;
            } else {
                startPauseBtn.textContent = config.pause_button_text || defaultConfig.pause_button_text;
            }
            resetBtn.textContent = config.reset_button_text || defaultConfig.reset_button_text;
            
            // 색상 업데이트
            const primaryColor = config.primary_color || defaultConfig.primary_color;
            const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const textColor = config.text_color || defaultConfig.text_color;
            
            document.body.style.background = `linear-gradient(to bottom right, ${backgroundColor}, #e0e7ff)`;
            timerTitle.style.color = textColor;
            timerDisplay.style.color = textColor;
            startPauseBtn.style.backgroundColor = primaryColor;
            resetBtn.style.backgroundColor = secondaryColor;
            
            // 폰트 적용
            timerTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
            startPauseBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
            resetBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.secondary_color || defaultConfig.secondary_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ secondary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        if (window.elementSdk) {
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    }
                },
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["timer_title", config.timer_title || defaultConfig.timer_title],
                ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
                ["pause_button_text", config.pause_button_text || defaultConfig.pause_button_text],
                ["reset_button_text", config.reset_button_text || defaultConfig.reset_button_text]
            ]);
        }

        // SDK 초기화
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                render,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // 초기 설정
        setTime();
        updateDisplay();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990f1deac696ea0d',t:'MTc2MDg2NDc1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>