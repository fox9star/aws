<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ“š Book Management API Â· ê²€ìƒ‰ ë°ëª¨</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#f7f9fc; --text:#2c3e50; --muted:#6c7a89; --primary:#4a6cf7; --card:#fff; --code:#f0f2f5; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font-family:'Noto Sans KR', Arial, sans-serif; }
    header { background:var(--card); border-bottom:1px solid #eaecee; padding:20px; position:sticky; top:0; z-index:10; }
    main { max-width: 960px; margin: 24px auto; padding: 0 16px; }
    .card { background:var(--card); border:1px solid #eaecee; border-radius:12px; padding:20px; margin-bottom:20px; }
    h1 { margin:0; font-size:22px; }
    h2 { margin-top:0; font-size:20px; }
    .row { display:grid; grid-template-columns:1fr auto; gap:12px; }
    input, select { padding:10px; border:1px solid #dfe4ea; border-radius:8px; width:100%; }
    button { background:var(--primary); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
    button:disabled { opacity:0.6; cursor:not-allowed; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { border-bottom:1px solid #eceff3; padding:10px; text-align:left; }
    .note { color:var(--muted); font-size:14px; }
    pre { background:var(--code); padding:12px; border-radius:8px; overflow-x:auto; }
    .small { font-size: 13px; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“š Book Management API Â· ê²€ìƒ‰ ë°ëª¨</h1>
    <p class="small">GitHub PagesëŠ” ì •ì  ë¬¸ì„œë¥¼ ì œê³µí•˜ë©°, ì•„ë˜ ê²€ìƒ‰ì€ ì™¸ë¶€ ì‹¤í–‰ ì¤‘ì¸ API ì„œë²„ì— ìš”ì²­í•©ë‹ˆë‹¤.</p>
  </header>

  <main>
    <section class="card">
      <h2>API ì„œë²„ ì£¼ì†Œ ì„¤ì •</h2>
      <p class="note">ì˜ˆ: <code>http://localhost:3000</code> ë˜ëŠ” í´ë¼ìš°ë“œì— ë°°í¬í•œ ì£¼ì†Œ</p>
      <div class="row">
        <input id="baseUrl" placeholder="API Base URL (ì˜ˆ: http://localhost:3000)" />
        <button id="saveUrl">ì €ì¥</button>
      </div>
      <p class="small">ì €ì¥ì€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>
    </section>

    <section class="card">
      <h2>ë¹ ë¥¸ ê²€ìƒ‰</h2>
      <div class="row">
        <input id="query" placeholder="í‚¤ì›Œë“œ (ì œëª©/ì €ì/ISBN)" />
        <button id="searchBtn">ê²€ìƒ‰</button>
      </div>
      <div id="results"></div>
    </section>

    <section class="card">
      <h2>í•„ë“œë³„ ê²€ìƒ‰</h2>
      <div class="row" style="grid-template-columns: 1fr 1fr 1fr auto;">
        <input id="title" placeholder="ì œëª©" />
        <input id="author" placeholder="ì €ì" />
        <input id="isbn" placeholder="ISBN" />
        <button id="fieldSearchBtn">ê²€ìƒ‰</button>
      </div>
      <div id="fieldResults"></div>
    </section>

    <section class="card">
      <h2>ì‚¬ìš©ë²•</h2>
      <ul>
        <li><strong>ë¹ ë¥¸ ê²€ìƒ‰:</strong> <code>GET /books?q=í‚¤ì›Œë“œ</code></li>
        <li><strong>í•„ë“œë³„ ê²€ìƒ‰:</strong> <code>GET /books?title=...&author=...&isbn=...</code></li>
      </ul>
      <pre><code>curl "http://localhost:3000/books?q=node"
curl "http://localhost:3000/books?title=deep&author=ë°•"</code></pre>
      <p class="note">CORSê°€ í™œì„±í™”ë˜ì–´ ìˆì–´ GitHub Pagesì—ì„œ API ì„œë²„ë¡œ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </section>
  </main>

  <script>
    const baseUrlInput = document.getElementById('baseUrl');
    const saveUrlBtn = document.getElementById('saveUrl');
    const queryInput = document.getElementById('query');
    const searchBtn = document.getElementById('searchBtn');
    const resultsDiv = document.getElementById('results');

    const titleInput = document.getElementById('title');
    const authorInput = document.getElementById('author');
    const isbnInput = document.getElementById('isbn');
    const fieldSearchBtn = document.getElementById('fieldSearchBtn');
    const fieldResultsDiv = document.getElementById('fieldResults');

    // Load saved base URL
    baseUrlInput.value = localStorage.getItem('bookapi_baseurl') || '';

    saveUrlBtn.onclick = () => {
      localStorage.setItem('bookapi_baseurl', baseUrlInput.value.trim());
      alert('API ì£¼ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    };

    async function fetchJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error('ìš”ì²­ ì‹¤íŒ¨: ' + res.status);
      return res.json();
    }

    function renderTable(container, items) {
      if (!items.length) {
        container.innerHTML = '<p class="note">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      const rows = items.map(b => `
        <tr>
          <td>${b.title || ''}</td>
          <td>${b.author || ''}</td>
          <td>${b.isbn || ''}</td>
          <td>${b.year || ''}</td>
        </tr>
      `).join('');
      container.innerHTML = `
        <table>
          <thead>
            <tr><th>ì œëª©</th><th>ì €ì</th><th>ISBN</th><th>ì—°ë„</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    searchBtn.onclick = async () => {
      const base = (baseUrlInput.value || '').trim();
      const q = (queryInput.value || '').trim();
      if (!base) return alert('API Base URLì„ ì…ë ¥í•˜ì„¸ìš”.');
      const url = base + '/books' + (q ? ('?q=' + encodeURIComponent(q)) : '');
      resultsDiv.innerHTML = '<p class="note">ê²€ìƒ‰ ì¤‘...</p>';
      try {
        const data = await fetchJSON(url);
        renderTable(resultsDiv, data);
      } catch (e) {
        resultsDiv.innerHTML = '<p class="note">ì˜¤ë¥˜: ' + e.message + '</p>';
      }
    };

    fieldSearchBtn.onclick = async () => {
      const base = (baseUrlInput.value || '').trim();
      if (!base) return alert('API Base URLì„ ì…ë ¥í•˜ì„¸ìš”.');
      const params = new URLSearchParams();
      if (titleInput.value) params.set('title', titleInput.value);
      if (authorInput.value) params.set('author', authorInput.value);
      if (isbnInput.value) params.set('isbn', isbnInput.value);
      const url = base + '/books' + (params.toString() ? ('?' + params.toString()) : '');
      fieldResultsDiv.innerHTML = '<p class="note">ê²€ìƒ‰ ì¤‘...</p>';
      try {
        const data = await fetchJSON(url);
        renderTable(fieldResultsDiv, data);
      } catch (e) {
        fieldResultsDiv.innerHTML = '<p class="note">ì˜¤ë¥˜: ' + e.message + '</p>';
      }
    };
  </script>
</body>
</html>